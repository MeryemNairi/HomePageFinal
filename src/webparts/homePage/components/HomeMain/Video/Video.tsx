import * as React from 'react';
import styles from './video.module.scss';
import { WebPartContext } from '@microsoft/sp-webpart-base';

interface IvideotNewsProps {
  context: WebPartContext;
}

const Video: React.FC<IvideotNewsProps> = (props: IvideotNewsProps) => {
  const [isPlaying, setIsPlaying] = React.useState<boolean>(false);
  const [currentVideoIndex, setCurrentVideoIndex] = React.useState<number>(0);
  const videoRef = React.useRef<HTMLVideoElement>(null);

  React.useEffect(() => {
    if (isPlaying && videoRef.current) {
      videoRef.current.play();
    } else if (!isPlaying && videoRef.current) {
      videoRef.current.pause();
    }
  }, [isPlaying, currentVideoIndex]);

  const handleTogglePlay = () => {
    setIsPlaying(!isPlaying);
  };

  const handleScroll = () => {
    setCurrentVideoIndex((prevIndex) => (prevIndex + 1) % videos.length);
    setIsPlaying(false); // Pause the current video when switching
  };

  const [videos, setVideos] = React.useState<string[]>([]);

  React.useEffect(() => {
    fetchVideosFromSharePoint();
  }, []);

  const fetchVideosFromSharePoint = async () => {
    try {
      const response = await fetch(
        `${props.context.pageContext.web.absoluteUrl}/_api/web/lists/getByTitle('CommVideos')/items?$select=FileRef`,
        {
          headers: {
            Accept: 'application/json;odata=nometadata',
          },
        }
      );
      const data = await response.json();
      const videoUrls = data.value.map((item: any) => item.FileRef);
      setVideos(videoUrls);
    } catch (error) {
      console.error('Error fetching videos:', error);
    }
  };

  return (
    <div className={styles.video_container}>
      {videos.length > 0 && (
        <div className={styles.video_holder}>
          <div className={styles.topBand} style={{ marginTop: '20px' }}>
            <svg width="240" height="39" viewBox="0 0 291 44" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="22" cy="22" r="22" fill="#03B586" />
              <path d="M65.868 29.208C64.4813 29.208 63.1987 28.9827 62.02 28.532C60.8587 28.064 59.8447 27.414 58.978 26.582C58.1287 25.7327 57.4613 24.7447 56.976 23.618C56.4907 22.4913 56.248 21.252 56.248 19.9C56.248 18.548 56.4907 17.3087 56.976 16.182C57.4613 15.0553 58.1373 14.076 59.004 13.244C59.8707 12.3947 60.8847 11.7447 62.046 11.294C63.2247 10.826 64.5073 10.592 65.894 10.592C67.298 10.592 68.5893 10.8347 69.768 11.32C70.964 11.788 71.978 12.49 72.81 13.426L71.12 15.064C70.4267 14.336 69.6467 13.7987 68.78 13.452C67.9133 13.088 66.986 12.906 65.998 12.906C64.9753 12.906 64.022 13.0793 63.138 13.426C62.2713 13.7727 61.5173 14.258 60.876 14.882C60.2347 15.506 59.732 16.2513 59.368 17.118C59.0213 17.9673 58.848 18.8947 58.848 19.9C58.848 20.9053 59.0213 21.8413 59.368 22.708C59.732 23.5573 60.2347 24.294 60.876 24.918C61.5173 25.542 62.2713 26.0273 63.138 26.374C64.022 26.7207 64.9753 26.894 65.998 26.894C66.986 26.894 67.9133 26.7207 68.78 26.374C69.6467 26.01 70.4267 25.4553 71.12 24.71L72.81 26.348C71.978 27.284 70.964 27.9947 69.768 28.48C68.5893 28.9653 67.2893 29.208 65.868 29.208ZM83.5131 15.09C84.6397 15.09 85.6277 15.3067 86.4771 15.74C87.3437 16.1733 88.0197 16.832 88.5051 17.716C88.9904 18.6 89.2331 19.718 89.2331 21.07V29H86.7371V21.356C86.7371 20.0213 86.4077 19.016 85.7491 18.34C85.1077 17.664 84.1977 17.326 83.0191 17.326C82.1351 17.326 81.3637 17.4993 80.7051 17.846C80.0464 18.1927 79.5351 18.704 79.1711 19.38C78.8244 20.056 78.6511 20.8967 78.6511 21.902V29H76.1551V15.22H78.5471V18.938L78.1571 17.95C78.6077 17.0487 79.3011 16.3467 80.2371 15.844C81.1731 15.3413 82.2651 15.09 83.5131 15.09ZM99.9883 29.156C98.515 29.156 97.215 28.8527 96.0883 28.246C94.979 27.6393 94.1123 26.8073 93.4883 25.75C92.8817 24.6927 92.5783 23.4793 92.5783 22.11C92.5783 20.7407 92.873 19.5273 93.4623 18.47C94.069 17.4127 94.8923 16.5893 95.9323 16C96.9897 15.3933 98.177 15.09 99.4943 15.09C100.829 15.09 102.008 15.3847 103.03 15.974C104.053 16.5633 104.85 17.3953 105.422 18.47C106.012 19.5273 106.306 20.7667 106.306 22.188C106.306 22.292 106.298 22.4133 106.28 22.552C106.28 22.6907 106.272 22.8207 106.254 22.942H94.5283V21.148H104.954L103.94 21.772C103.958 20.888 103.776 20.0993 103.394 19.406C103.013 18.7127 102.484 18.1753 101.808 17.794C101.15 17.3953 100.378 17.196 99.4943 17.196C98.6277 17.196 97.8563 17.3953 97.1803 17.794C96.5043 18.1753 95.9757 18.7213 95.5943 19.432C95.213 20.1253 95.0223 20.9227 95.0223 21.824V22.24C95.0223 23.1587 95.2303 23.982 95.6463 24.71C96.0797 25.4207 96.6777 25.9753 97.4403 26.374C98.203 26.7727 99.0783 26.972 100.066 26.972C100.881 26.972 101.618 26.8333 102.276 26.556C102.952 26.2787 103.542 25.8627 104.044 25.308L105.422 26.92C104.798 27.648 104.018 28.2027 103.082 28.584C102.164 28.9653 101.132 29.156 99.9883 29.156ZM107.389 29L113.317 21.304L113.291 22.578L107.649 15.22H110.431L114.747 20.888H113.681L117.997 15.22H120.727L115.007 22.63L115.033 21.304L121.013 29H118.179L113.629 22.968L114.643 23.124L110.171 29H107.389ZM123.737 29V15.22H126.233V29H123.737ZM124.985 12.568C124.5 12.568 124.092 12.412 123.763 12.1C123.451 11.788 123.295 11.4067 123.295 10.956C123.295 10.488 123.451 10.098 123.763 9.786C124.092 9.474 124.5 9.318 124.985 9.318C125.47 9.318 125.869 9.474 126.181 9.786C126.51 10.0807 126.675 10.4533 126.675 10.904C126.675 11.372 126.519 11.7707 126.207 12.1C125.895 12.412 125.488 12.568 124.985 12.568ZM139.553 29V26.088L139.423 25.542V20.576C139.423 19.5187 139.111 18.704 138.487 18.132C137.88 17.5427 136.961 17.248 135.731 17.248C134.916 17.248 134.119 17.3867 133.339 17.664C132.559 17.924 131.9 18.2793 131.363 18.73L130.323 16.858C131.033 16.286 131.883 15.8527 132.871 15.558C133.876 15.246 134.925 15.09 136.017 15.09C137.906 15.09 139.362 15.5493 140.385 16.468C141.407 17.3867 141.919 18.7907 141.919 20.68V29H139.553ZM135.029 29.156C134.006 29.156 133.105 28.9827 132.325 28.636C131.562 28.2893 130.973 27.8127 130.557 27.206C130.141 26.582 129.933 25.88 129.933 25.1C129.933 24.3547 130.106 23.6787 130.453 23.072C130.817 22.4653 131.397 21.98 132.195 21.616C133.009 21.252 134.101 21.07 135.471 21.07H139.839V22.864H135.575C134.327 22.864 133.486 23.072 133.053 23.488C132.619 23.904 132.403 24.4067 132.403 24.996C132.403 25.672 132.671 26.218 133.209 26.634C133.746 27.0327 134.491 27.232 135.445 27.232C136.381 27.232 137.195 27.024 137.889 26.608C138.599 26.192 139.111 25.5853 139.423 24.788L139.917 26.504C139.587 27.3187 139.007 27.9687 138.175 28.454C137.343 28.922 136.294 29.156 135.029 29.156ZM157.134 29L151.102 15.22H153.702L159.058 27.7H157.81L163.27 15.22H165.714L159.682 29H157.134ZM168.044 29V15.22H170.54V29H168.044ZM169.292 12.568C168.806 12.568 168.399 12.412 168.07 12.1C167.758 11.788 167.602 11.4067 167.602 10.956C167.602 10.488 167.758 10.098 168.07 9.786C168.399 9.474 168.806 9.318 169.292 9.318C169.777 9.318 170.176 9.474 170.488 9.786C170.817 10.0807 170.982 10.4533 170.982 10.904C170.982 11.372 170.826 11.7707 170.514 12.1C170.202 12.412 169.794 12.568 169.292 12.568ZM180.999 29.156C179.665 29.156 178.469 28.8613 177.411 28.272C176.371 27.6827 175.548 26.8593 174.941 25.802C174.335 24.7447 174.031 23.514 174.031 22.11C174.031 20.706 174.335 19.484 174.941 18.444C175.548 17.3867 176.371 16.5633 177.411 15.974C178.469 15.3847 179.665 15.09 180.999 15.09C182.161 15.09 183.209 15.35 184.145 15.87C185.081 16.39 185.827 17.17 186.381 18.21C186.953 19.25 187.239 20.55 187.239 22.11C187.239 23.67 186.962 24.97 186.407 26.01C185.87 27.05 185.133 27.8387 184.197 28.376C183.261 28.896 182.195 29.156 180.999 29.156ZM181.207 26.972C182.074 26.972 182.854 26.7727 183.547 26.374C184.258 25.9753 184.813 25.412 185.211 24.684C185.627 23.9387 185.835 23.0807 185.835 22.11C185.835 21.122 185.627 20.2727 185.211 19.562C184.813 18.834 184.258 18.2707 183.547 17.872C182.854 17.4733 182.074 17.274 181.207 17.274C180.323 17.274 179.535 17.4733 178.841 17.872C178.148 18.2707 177.593 18.834 177.177 19.562C176.761 20.2727 176.553 21.122 176.553 22.11C176.553 23.0807 176.761 23.9387 177.177 24.684C177.593 25.412 178.148 25.9753 178.841 26.374C179.535 26.7727 180.323 26.972 181.207 26.972ZM185.913 29V25.282L186.069 22.084L185.809 18.886V9.708H188.305V29H185.913ZM199.164 29.156C197.691 29.156 196.391 28.8527 195.264 28.246C194.155 27.6393 193.288 26.8073 192.664 25.75C192.057 24.6927 191.754 23.4793 191.754 22.11C191.754 20.7407 192.049 19.5273 192.638 18.47C193.245 17.4127 194.068 16.5893 195.108 16C196.165 15.3933 197.353 15.09 198.67 15.09C200.005 15.09 201.183 15.3847 202.206 15.974C203.229 16.5633 204.026 17.3953 204.598 18.47C205.187 19.5273 205.482 20.7667 205.482 22.188C205.482 22.292 205.473 22.4133 205.456 22.552C205.456 22.6907 205.447 22.8207 205.43 22.942H193.704V21.148H204.13L203.116 21.772C203.133 20.888 202.951 20.0993 202.57 19.406C202.189 18.7127 201.66 18.1753 200.984 17.794C200.325 17.3953 199.554 17.196 198.67 17.196C197.803 17.196 197.032 17.3953 196.356 17.794C195.68 18.1753 195.151 18.7213 194.77 19.432C194.389 20.1253 194.198 20.9227 194.198 21.824V22.24C194.198 23.1587 194.406 23.982 194.822 24.71C195.255 25.4207 195.853 25.9753 196.616 26.374C197.379 26.7727 198.254 26.972 199.242 26.972C200.057 26.972 200.793 26.8333 201.452 26.556C202.128 26.2787 202.717 25.8627 203.22 25.308L204.598 26.92C203.974 27.648 203.194 28.2027 202.258 28.584C201.339 28.9653 200.308 29.156 199.164 29.156ZM214.85 29.156C213.463 29.156 212.233 28.8527 211.158 28.246C210.083 27.6393 209.234 26.8073 208.61 25.75C207.986 24.6753 207.674 23.462 207.674 22.11C207.674 20.7407 207.986 19.5273 208.61 18.47C209.234 17.4127 210.083 16.5893 211.158 16C212.233 15.3933 213.463 15.09 214.85 15.09C216.219 15.09 217.441 15.3933 218.516 16C219.608 16.5893 220.457 17.4127 221.064 18.47C221.688 19.51 222 20.7233 222 22.11C222 23.4793 221.688 24.6927 221.064 25.75C220.457 26.8073 219.608 27.6393 218.516 28.246C217.441 28.8527 216.219 29.156 214.85 29.156ZM214.85 26.972C215.734 26.972 216.523 26.7727 217.216 26.374C217.927 25.9753 218.481 25.412 218.88 24.684C219.279 23.9387 219.478 23.0807 219.478 22.11C219.478 21.122 219.279 20.2727 218.88 19.562C218.481 18.834 217.927 18.2707 217.216 17.872C216.523 17.4733 215.734 17.274 214.85 17.274C213.966 17.274 213.177 17.4733 212.484 17.872C211.791 18.2707 211.236 18.834 210.82 19.562C210.404 20.2727 210.196 21.122 210.196 22.11C210.196 23.0807 210.404 23.9387 210.82 24.684C211.236 25.412 211.791 25.9753 212.484 26.374C213.177 26.7727 213.966 26.972 214.85 26.972ZM229.404 29.156C228.26 29.156 227.168 29 226.128 28.688C225.105 28.376 224.299 27.9947 223.71 27.544L224.75 25.568C225.339 25.9667 226.067 26.3047 226.934 26.582C227.801 26.8593 228.685 26.998 229.586 26.998C230.747 26.998 231.579 26.8333 232.082 26.504C232.602 26.1747 232.862 25.7153 232.862 25.126C232.862 24.6927 232.706 24.3547 232.394 24.112C232.082 23.8693 231.666 23.6873 231.146 23.566C230.643 23.4447 230.08 23.3407 229.456 23.254C228.832 23.15 228.208 23.0287 227.584 22.89C226.96 22.734 226.388 22.526 225.868 22.266C225.348 21.9887 224.932 21.616 224.62 21.148C224.308 20.6627 224.152 20.0213 224.152 19.224C224.152 18.392 224.386 17.664 224.854 17.04C225.322 16.416 225.981 15.9393 226.83 15.61C227.697 15.2633 228.719 15.09 229.898 15.09C230.799 15.09 231.709 15.2027 232.628 15.428C233.564 15.636 234.327 15.9393 234.916 16.338L233.85 18.314C233.226 17.898 232.576 17.612 231.9 17.456C231.224 17.3 230.548 17.222 229.872 17.222C228.78 17.222 227.965 17.404 227.428 17.768C226.891 18.1147 226.622 18.5653 226.622 19.12C226.622 19.588 226.778 19.952 227.09 20.212C227.419 20.4547 227.835 20.6453 228.338 20.784C228.858 20.9227 229.43 21.044 230.054 21.148C230.678 21.2347 231.302 21.356 231.926 21.512C232.55 21.6507 233.113 21.85 233.616 22.11C234.136 22.37 234.552 22.734 234.864 23.202C235.193 23.67 235.358 24.294 235.358 25.074C235.358 25.906 235.115 26.6253 234.63 27.232C234.145 27.8387 233.46 28.3153 232.576 28.662C231.692 28.9913 230.635 29.156 229.404 29.156Z" fill="white" />
              <path d="M34.2173 19.4922C36.2034 20.6708 36.1688 23.5573 34.1551 24.688L17.9291 33.7987C15.9154 34.9293 13.4328 33.4561 13.4605 31.1469L13.6834 12.5394C13.7111 10.2301 16.2282 8.81681 18.2142 9.99539L34.2173 19.4922Z" fill="white" />
            </svg>
          </div>
          <video
            ref={videoRef}
            src={videos[currentVideoIndex]}
            controls
            className={styles.video}
            onClick={handleTogglePlay}
          />
          <div className={styles.bottomBand}>
            <div style={{ display: 'flex', alignItems: 'center', marginTop: '20px' }}>
              <div style={{ flex: 1 }}>
                <p style={{ fontWeight: 'bold', marginLeft: '10px' }}>Video:</p>
                <p style={{ marginLeft: '10px' }}>Inside Cnexia Tech</p>
              </div>
              <button style={{ marginRight: '6px', marginTop: '20px' }} onClick={handleScroll}>
                <svg width="65" height="19" viewBox="0 0 101 29" fill="transparent" xmlns="http://www.w3.org/2000/svg">
                  <rect width="47.8421" height="28.8421" fill="transparent" />
                  <rect x="52.0947" width="48.9052" height="28.8421" fill="transparent" />
                  <path d="M74 5L82 14.5L74 24" stroke="#00966C" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                  <path d="M27.231 5.01562L19.5915 14.5077L27.231 23.9998" stroke="#00966C" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                </svg>
              </button>
            </div>
          </div>
          {!isPlaying && (
            <div className={styles.PlayBtn}>
              <div className={styles.PlayIcon}>
                <button className={styles.Play} onClick={handleTogglePlay}>
                  
                </button>
              </div>
            </div>
          )}
        </div>
      )}
    </div>
  );
};

export default Video;
